
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>5.1.1. Running PyMPA &#8212; PyMPA 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Creating an output catalog and verify detections" href="../output.html" />
    <link rel="prev" title="5. Main Program" href="../main.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
     

  </head><body>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../output.html" title="6. Creating an output catalog and verify detections"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../main.html" title="5. Main Program"
             accesskey="P">previous</a> |</li>
    <li><img src="../_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    
    <a href="../index.html">PyMPA 1.0.0 documentation</a> &#187;
    

          <li class="nav-item nav-item-1"><a href="../main.html" accesskey="U">5. Main Program</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="running-pympa">
<h1>5.1.1. Running PyMPA<a class="headerlink" href="#running-pympa" title="Permalink to this headline">Â¶</a></h1>
<p>The input files are those prepared in advance by using pre-processing tools. The only input file that changes is the parameters24 input file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># input parameters for runnig 27 version</span>
<span class="c1"># line1 = stations available,</span>
<span class="c1"># line2 = channels available,</span>
<span class="c1"># line3 = networks available,</span>
<span class="c1"># line4 = low bandpass filter frequency,</span>
<span class="c1"># line5 = high bandpass filter frequency,</span>
<span class="c1"># line6 = sample tolerance in detecting maximum cft amplitude for each channel,</span>
<span class="c1"># line7 = cross-correlation threshold to be overcome by cft,</span>
<span class="c1"># line8 = min number of channels overcoming the cross-correlation threshold,</span>
<span class="c1"># line9 = template duration(s),</span>
<span class="c1"># line10 = UTCDateTime.DEFAULT_PRECISION (number of digits considered in fractions of seconds),</span>
<span class="c1"># line11 = string variable containing the directory name for continuous 24h waveforms,</span>
<span class="c1"># line12 = string variable for templates&#39; directory,</span>
<span class="c1"># line13 = string variable for travel times directory,</span>
<span class="c1"># line14 = filename for day list to process,</span>
<span class="c1"># line15 = filename for zmap catalog,</span>
<span class="c1"># line16 = template start number,</span>
<span class="c1"># line17 = template stop number(if line16==0  and line17==0 all templates are processed,</span>
<span class="c1"># line18 = multiplying factor for MAD to determine threshold </span>
<span class="c1"># line 19 = multiplying factor to remove daily cft channels with std greater than (average std from all channels * factor at at line 19) </span>
<span class="c1"># line 20 = multiplying factor to remove daily cft channels with std smaller than (average std from all channels * factor at at line 20)</span>
<span class="c1"># line 21 = maximum number of templates to be used in template matching (choice is made preferring the closest channels)</span>
<span class="c1"># line 22 = number of chunks per day (1=86400s, 2=43200, 3=28800, 4=21600, 6=14400 etc... icreasing the factor allows reducing memory consumption) </span>
<span class="n">APEC</span> <span class="n">ATBU</span> <span class="n">ATCA</span> <span class="n">ATCC</span> <span class="n">ATFO</span> <span class="n">ATLO</span> <span class="n">ATPC</span> <span class="n">ATPI</span> <span class="n">ATSC</span> <span class="n">ATVO</span> <span class="n">BADI</span> <span class="n">FOSV</span> <span class="n">FRON</span> <span class="n">MURB</span> <span class="n">NARO</span> <span class="n">PARC</span> <span class="n">PIEI</span> <span class="n">PE3</span> <span class="n">SSFR</span>
<span class="n">EHE</span> <span class="n">EHN</span> <span class="n">EHZ</span> <span class="n">HHE</span> <span class="n">HHN</span> <span class="n">HHZ</span>
<span class="n">IV</span>
<span class="mf">3.0</span>
<span class="mf">8.0</span>
<span class="mi">6</span>
<span class="mf">0.35</span>
<span class="mi">6</span>
<span class="mi">5</span>
<span class="mi">6</span>
<span class="mi">24</span><span class="n">h</span>
<span class="n">template</span>
<span class="n">ttimes</span>
<span class="n">lista1</span>
<span class="n">templates</span><span class="o">.</span><span class="n">zmap</span>
<span class="mi">200</span>
<span class="mi">203</span>
<span class="mi">8</span>
<span class="mf">1.5</span>
<span class="mf">0.25</span>
<span class="mi">12</span>
<span class="mi">6</span>
</pre></div>
</div>
<p>Needed input files:</p>
<ul class="simple">
<li><p>Events in a catalog: e.g. templates.zmap (quakeml or zmap format) see ObsPy for format</p></li>
<li><p>Suitable velocity model for computing travel times</p></li>
<li><p>Station inventory (format consistent with ObsPy read_inventory routine see <a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.inventory.inventory.read_inventory.html">https://docs.obspy.org/packages/autogen/obspy.core.inventory.inventory.read_inventory.html</a>)</p></li>
<li><p>Days to process: one column file including days to process e.g. lista1</p></li>
<li><p>Set parameters: e.g. parameters24</p></li>
<li><p>Input directory ./template where trimmed templates are found</p></li>
<li><p>Input directory ./24h where 24 hours continuous waveforms are stores</p></li>
<li><p>Input directory /ttimes (find moveout times from different channels used to synchronize cross-correlation functions)</p></li>
</ul>
<p>Output:</p>
<ul class="simple">
<li><p>Output files .cat, .stats, .stats.mag, .except (details on the output )</p></li>
</ul>
<p>Detections (.cat)</p>
<p>Detections are listed in a .cat file (e.g. 200.100723.cat)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Columns in 200.100723.cat file are:</p>
<ul class="simple">
<li><p>Template number corresponding to the python line index in file templates.zmap (event catalog)</p></li>
<li><p>UTC Date and Time (2010-07-23T02:20:29.833321Z) Time precision selection is possible in parameters24 input file</p></li>
<li><p>Magnitude estimated as in Peng and Zhao (2009). The magnitude of the detected event is calculated as the median value of the maximum amplitude ratios for all channels between the template and detected event, assuming that a 10-fold increase in amplitude corresponds to a one-unit increase in magnitude.</p></li>
<li><p>Average cross-correlation estimated from the channels that concurred to the detection. This value is estimated using a time shift between the channels that optimized the stacked CFT.</p></li>
<li><p>Threshold value (ratio between the amplitude of the CFT stacking and the daily MAD Median Absolute Deviation). The higher the threshold the most probable the detection. This value is estimated using a time shift between the channels that optimized the stacked CFT.</p></li>
<li><p>Average cross-correlation estimated from the channels that concurred to the detection at no time shift.</p></li>
<li><p>Threshold value (ratio between the amplitude of the CFT stacking and the daily MAD Median Absolute Deviation). No time shift of the signal cross-correlation functions is allowed.</p></li>
<li><p>Number of channels for which the cross-correlation is over a certain lower bound (e.g. 0.35)</p></li>
</ul>
<p>Single Channel Statistics is listed in a .stats file (e.g. 200.100723.stats)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Columns in 200.100723.stats file are:</p>
<ul class="simple">
<li><p>Network.Station</p></li>
<li><p>Channel</p></li>
<li><p>Cross-correlation value at no time shift</p></li>
<li><p>Cross-correlation value with time shift (nsamples) as in column 5</p></li>
<li><p>Time shift in nsamples (e.g. -1.0 means that the shift is equal to 0.05 at 20Hz sampling rate)</p></li>
</ul>
<p>At the end of each trace id you find other parameters related to the detection in part repeating the detection parameters
in .cat file and in part related to the cross-correlations values over some limits (0.3 - 0.5 - 0.7 - 0.9).</p>
<ul class="simple">
<li><p>date, template_num, detection_num, date&amp;time, template_magnitude, detection_magnitude, threshold_fixed, MAD, ave_crosscc, threshold_record, ave_crosscc_0, threshold_record_0, num_channels_gt0.3, num_channels_gt0.5, num_channels_gt0.7, num_channels_gt0.9</p></li>
<li><p>100723 201 0 2010-07-23T22:20:57.712239Z 1.51 0.07 9.0 0.0342230009997 0.486 14.193 0.301 8.796 11.0 5.0 2.0 0.0</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Columns in 200.100723.stats.mag file are:</p>
<ul class="simple">
<li><p>Station.Channel Mag.</p></li>
<li><p>date, template_num, detection_num, date&amp;time, template_magnitude, detection_magnitude, threshold_fixed, MAD, ave_crosscc, threshold_record, ave_crosscc_0, threshold_record_0, num_channels_gt0.3, num_channels_gt0.5, num_channels_gt0.7, num_channels_gt0.9</p></li>
<li><p>100723 201 0 2010-07-23T22:20:57.712239Z 1.51 0.07 9.0 0.0342230009997 0.486 14.193 0.301 8.796 11.0 5.0 2.0 0.0</p></li>
</ul>
<p>Note that input and output file names, inventories, template catalogs, velocity models are recalled also in the next steps and remain almost fixed. Parameters in files .par could change.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../main.html"
                        title="previous chapter">5. Main Program</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../output.html"
                        title="next chapter">6. Creating an output catalog and verify detections</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/sub/main.pympa.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../output.html" title="6. Creating an output catalog and verify detections"
             >next</a> |</li>
        <li class="right" >
          <a href="../main.html" title="5. Main Program"
             >previous</a> |</li>
    <li><img src="../_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    
    <a href="../index.html">PyMPA 1.0.0 documentation</a> &#187;
    

          <li class="nav-item nav-item-1"><a href="../main.html" >5. Main Program</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 2019, Alessandro Vuan.
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    Last updated on None.
    
    <br />

    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.0.0b1.
    </div>

  </body>
</html>